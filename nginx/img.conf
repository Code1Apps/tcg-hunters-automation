server {
    listen 80;
    listen [::]:80;
    
    # Replace with your domain or IP
    server_name auto.tcghunters.com;
    
    # Root directory (pointing to public)
    root /var/www/auto.tcghunters.com/public;
    
    # Logging
    access_log /var/log/nginx/auto.tcghunters.com-access.log;
    error_log /var/log/nginx/auto.tcghunters.com-error.log;

    # Security headers
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    
    # CORS headers (adjust origins as needed)
    add_header Access-Control-Allow-Origin "*" always;
    add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept" always;
    
    # Handle OPTIONS requests for CORS preflight
    if ($request_method = 'OPTIONS') {
        return 204;
    }
    
    # Main location block for serving images
    location / {
        # Try to serve the file directly, return 404 if not found
        try_files $uri $uri/ =404;
        
        # Enable directory listing (optional, remove if you don't want this)
        autoindex on;
        autoindex_exact_size off;
        autoindex_localtime on;
        
        # Cache control for images
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
    
    # Specific location for tmp directory
    location /tmp/ {
        alias /var/www/tcg-hunters-automation/public/img/tmp/;
        try_files $uri $uri/ =404;
        
        # Shorter cache for temporary images
        expires 1d;
        add_header Cache-Control "public";
    }
    
    # Image type specific settings
    location ~* \.(jpg|jpeg|png|gif|webp|svg|ico)$ {
        try_files $uri =404;
        expires 30d;
        add_header Cache-Control "public, immutable";
        
        # Enable gzip compression for SVG
        gzip on;
        gzip_types image/svg+xml;
    }
    
    # Deny access to hidden files
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Deny access to backup files
    location ~ ~$ {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Security: Prevent execution of scripts
    location ~* \.(php|pl|py|jsp|asp|sh|cgi)$ {
        deny all;
        return 403;
    }
}

# SSL/HTTPS configuration (uncomment and configure when ready)
# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2;
#     
#     server_name img.tcghunters.com;
#     
#     # SSL certificates (use Let's Encrypt or your own certificates)
#     ssl_certificate /etc/letsencrypt/live/img.tcghunters.com/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/img.tcghunters.com/privkey.pem;
#     
#     # SSL configuration
#     ssl_protocols TLSv1.2 TLSv1.3;
#     ssl_ciphers HIGH:!aNULL:!MD5;
#     ssl_prefer_server_ciphers on;
#     ssl_session_cache shared:SSL:10m;
#     ssl_session_timeout 10m;
#     
#     # Root directory
    root /var/www/tcg-hunters-automation/public;
#     
#     # Logging
#     access_log /var/log/nginx/img-ssl-access.log;
#     error_log /var/log/nginx/img-ssl-error.log;
#     
#     # Include all the same location blocks from above
#     include /etc/nginx/snippets/img-locations.conf;
# }

# HTTP to HTTPS redirect (uncomment when SSL is configured)
# server {
#     listen 80;
#     listen [::]:80;
#     server_name img.tcghunters.com;
#     return 301 https://$server_name$request_uri;
# }
